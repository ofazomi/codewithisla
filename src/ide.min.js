(function(exports){exports.ui={};exports.ui.tutor={hide:function(){$("#tutor").hide()},displayCode:function(code){$("#tutor").html("Write <span class='code'>"+code+"</span> below")},displayMessage:function(text){$("#tutor").text(text)}};exports.ui.textHelper={displayMessage:function(text){var html=text.replace(/\n/g,"<br/>");html=html.replace(/  /g,"&nbsp;&nbsp;");$("#help").html(html)},indicate:function(consoleIndicator,event,data){consoleIndicator.write({event:event,data:data,id:"textHelper"})}}})(typeof exports==="undefined"?this:exports);(function(exports){var Tutor=function(steps,ui){this.write=function(e){if(e.event="demo:code:new"){if(isEquivalent(e.code,currentStep)){nextStep()}}};if(steps.length===0){ui.hide();return}var currentStep;var nextStep=function(){var step=steps.shift();currentStep=step;if(step!==undefined){ui.displayCode(step)}else{ui.displayMessage("Make up your own code")}};nextStep()};var isEquivalent=function(code1,code2){return code1===code2};exports.Tutor=Tutor})(typeof exports==="undefined"?this:exports);(function(exports){var Isla;if(typeof module!=="undefined"&&module.exports){Isla=require("../node_modules/isla/src/isla.js").Isla}else{Isla=window.Isla}var EnvStore=function(){var committedEnvs=[];var tempEnv=undefined;this.write=function(e){if(e.event==="commit"){if(tempEnv!==undefined){committedEnvs.push(tempEnv);tempEnv=undefined}else{throw"Temp environment is null or undefined"}}else{if(e.env!=null){tempEnv=extend(true,{},e.env)}else{throw"Environment is null or undefined"}}},this.latestCommitted=function(){return extend(true,{},committedEnvs[committedEnvs.length-1])};this.latest=function(){var env;if(tempEnv===undefined){env=committedEnvs[committedEnvs.length-1]}else{env=tempEnv}return extend(true,{},env)}};var extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==="boolean"){deep=target;target=arguments[1]||{};i=2}if(typeof target!=="object"&&!Isla.Utils.type(target)==="Function"){target={}}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(Isla.Utils.type(copy)==="Object"||(copyIsArray=Isla.Utils.type(copy)==="Array"))){if(copyIsArray){copyIsArray=false;clone=src&&Isla.Utils.type(src)==="Array"?src:[]}else{clone=src&&Isla.Utils.type(src)==="Object"?src:{}}target[name]=extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};exports.EnvStore=EnvStore;exports.EnvStore.extend=extend})(typeof exports==="undefined"?this:exports);(function(exports){function Eventer(){var callbacks={};this.addListener=function(obj,event,callback){callbacks[event]=callbacks[event]||[];callbacks[event].push({obj:obj,callback:callback});return this};this.addListener;this.on=this.addListener;this.removeListener=function(obj,event){if(callbacks[event]!==undefined){for(var i=0;i<callbacks[event].length;i++){if(callbacks[event][i].obj===obj){callbacks[event].splice(i,1);break}}}};this.emit=function(event,data){var eventCallbacks=callbacks[event];if(eventCallbacks!==undefined){for(var i=0;i<eventCallbacks.length;i++){var callbackObj=eventCallbacks[i];callbackObj.callback.call(callbackObj.obj,data)}}return this}}exports.Eventer=Eventer})(typeof exports==="undefined"?this:exports);(function(exports){var Isla,_;if(typeof module!=="undefined"&&module.exports){Isla=require("../node_modules/isla/src/isla.js").Isla;_=require("Underscore")}else{Isla=window.Isla;_=window._}var codeAnalyzer={parses:function(code){try{Isla.Parser.parse(code);return true}catch(e){return false}},expression:function(code){var block;try{var ast=Isla.Parser.parse(code);block=Isla.Parser.extract(ast,"root",0,"block")}catch(e){return undefined}if(block.length>1){throw"You passed code with more than one expression."}else{return Isla.Parser.extract(block,0,"expression",0)}},expressionTokens:function(code){var expression=codeAnalyzer.expression(code);return expression!==undefined?expression.c:undefined},expressionSyntaxTokens:function(line){var tokens=codeAnalyzer.expressionTokens(line);if(tokens!==undefined){return expressionSyntaxTokens(tokens,[])}else{return undefined}},getLineNumber:function(text,index){if(index!==undefined){var lineNumber=0;for(var i=0;i<text.length;i++){if(i===index&&codeAnalyzer.isAtNewline(text,i)){return undefined}else if(codeAnalyzer.isAtNewline(text,i)){lineNumber++}else if(i===index){return lineNumber}}}},getLine:function(text,lineNumber){if(lineNumber!==undefined){return codeAnalyzer.splitLines(text)[lineNumber]}},getSyntaxTokenIndex:function(text,index){var lineNumber=codeAnalyzer.getLineNumber(text,index);var line=codeAnalyzer.getLine(text,lineNumber);var syntaxTokens=codeAnalyzer.expressionSyntaxTokens(line);if(syntaxTokens===undefined){return undefined}var lineIndex=codeAnalyzer.getLineIndex(text,index);var tokenIndex=undefined;for(var i=0;i<syntaxTokens.length;i++){var tok=syntaxTokens[i];if(lineIndex>=tok.index&&lineIndex<tok.index+tok.code.length){tokenIndex=i;break}}return tokenIndex},isAtNewline:function(text,index){return text.substring(index,index+1)==="\n"},getCode:function(token){if(token.c[0].tag!==undefined){return codeAnalyzer.getCode(token.c[0])}else{return token.code||token.c[0]}},getLineIndex:function(text,index){var lineNumber=codeAnalyzer.getLineNumber(text,index);return index-_.reduce(codeAnalyzer.splitLines(text),function(acc,x,i){return i<lineNumber?acc+x+"\n":acc},"").length},splitLines:function(text){return text.split("\n")},getSyntaxNode:function(text,index){var lineNumber=codeAnalyzer.getLineNumber(text,index);var line=codeAnalyzer.getLine(text,lineNumber);var syntaxTokens=codeAnalyzer.expressionSyntaxTokens(line);var syntaxTokenIndex=codeAnalyzer.getSyntaxTokenIndex(text,index);return syntaxTokens[syntaxTokenIndex]}};var expressionSyntaxTokens=function(tokens,pieces){for(var i=0;i<tokens.length;i++){var token=tokens[i];if(token.syntax!==undefined){var piece={};piece.code=codeAnalyzer.getCode(token);piece.syntax=token.syntax;piece.index=token.index;piece.node=token;pieces.push(piece)}else{expressionSyntaxTokens(token.c,pieces)}}return pieces};exports.codeAnalyzer=codeAnalyzer})(typeof exports==="undefined"?this:exports);(function(exports){var Isla,_,multimethod,codeAnalyzer;if(typeof module!=="undefined"&&module.exports){Isla=require("../node_modules/isla/src/isla.js").Isla;_=require("Underscore");multimethod=require("multimethod");codeAnalyzer=require("../src/code-analyzer").codeAnalyzer}else{Isla=window.Isla;_=window._;multimethod=window.multimethod;codeAnalyzer=window.codeAnalyzer}var getReferenceStr=function(node,env){var refId=Isla.Interpreter.evaluateValue(node,env).ref;if(Isla.Utils.type(refId)==="String"){return refId}else{return refId[0]+" "+refId[1]}};var getValueStr=function(node,env){if(node.c[0].tag==="literal"){return codeAnalyzer.getCode(node)}else{return getReferenceStr(node.c[0],env)}};var describe=multimethod().dispatch(function(node){return node.tag}).when("type_assignment",function(node,env){var ref=getReferenceStr(node.c[0].c[0],env);var type=Isla.Interpreter.interpretAst(node.c[2],env);return"Makes a "+type+" called "+ref+"."}).when("value_assignment",function(node,env){var assiRef=getReferenceStr(node.c[0].c[0],env);var value=getValueStr(node.c[2],env);return assiRef+" is now "+value+"."}).when("list_assignment",function(node,env){var listRef=getReferenceStr(node.c[3].c[0],env);var value=getValueStr(node.c[1],env);var operation=Isla.Parser.extract(node.c,0,"list_operation",0).tag;if(operation==="add"){return"Puts "+value+" into the list called "+listRef+"."}else if(operation==="take"){return"Takes "+value+" out of the list called "+listRef+"."}}).when("invocation",function(node,env){var fnNameNode=Isla.Parser.extract(node,"invocation",0);var fnId=Isla.Interpreter.interpretAst(fnNameNode,env);var descriptionFn=Isla.Interpreter.resolve({ref:fnId},env).description;var paramValue=getValueStr(node.c[1],env);return descriptionFn(paramValue)});var expressionDescriber={describe:describe};exports.expressionDescriber=expressionDescriber})(typeof exports==="undefined"?this:exports);(function(exports){var Isla,_,multimethod;if(typeof module!=="undefined"&&module.exports){Isla=require("../node_modules/isla/src/isla.js").Isla;codeAnalyzer=require("../src/code-analyzer").codeAnalyzer}else{Isla=window.Isla;codeAnalyzer=window.codeAnalyzer}var nodeDescriber={describe:function(text,index,env){var syntaxNode=codeAnalyzer.getSyntaxNode(text,index);if(syntaxNode.syntax==="variable"){var val;if(syntaxNode.node.tag==="scalar"){val=Isla.Interpreter.evaluateValue(syntaxNode.node,env).val}else if(syntaxNode.node.tag==="identifier"){val=Isla.Interpreter.resolve({ref:syntaxNode.node.c[0]},env)}return describeValue(val,env)}else if(syntaxNode.syntax==="attribute"){var lineNumber=codeAnalyzer.getLineNumber(text,index);var line=codeAnalyzer.getLine(text,lineNumber);var tokens=codeAnalyzer.expressionTokens(line);var objToken=tokens[getTokenIndex(text,index)];var val=Isla.Interpreter.evaluateValue(objToken.c[0],env).val;return describeValue(val,env)}else{return undefined}}};var describeValue=function(unresolvedVal,env){var description="Has no value.";if(unresolvedVal!==undefined){val=Isla.Interpreter.resolve(unresolvedVal,env);if(Isla.Utils.type(val)==="String"){description="'"+val+"'"}else{description="";var lines=val.toString().split("\n");for(var i=0;i<lines.length;i++){if(lines[i].indexOf("_")===-1){description+=lines[i];if(i<lines.length-1){description+="\n"}}}}}return description};var getTokenIndex=function(text,index){var tokenIndex=undefined;var lineNumber=codeAnalyzer.getLineNumber(text,index);var line=codeAnalyzer.getLine(text,lineNumber);var tokens=codeAnalyzer.expressionTokens(line);if(tokens!==undefined){var lineIndex=codeAnalyzer.getLineIndex(text,index);tokenIndex=0;for(var i=0;i<tokens.length;i++){var tok=tokens[i];if(lineIndex>=tok.index){tokenIndex=i}}}return tokenIndex};exports.nodeDescriber=nodeDescriber})(typeof exports==="undefined"?this:exports);(function(exports){var codeAnalyzer;if(typeof module!=="undefined"&&module.exports){codeAnalyzer=require("../src/code-analyzer").codeAnalyzer}else{codeAnalyzer=window.codeAnalyzer}mapper={getIndex:function(terminal,text,relativePoint){var charDimes=terminal.getCharDimes();var point=offset(relativePoint,terminal.getOffset());for(var i=0,x=0,y=charDimes.y;i<text.length;i++){if(codeAnalyzer.isAtNewline(text,i)){y+=charDimes.y;x=0}else{x+=charDimes.x}if(point.x>=0&&point.x>=x-charDimes.x&&point.x<x&&point.y>=y-charDimes.y&&point.y<y){return i}}return undefined},getLineNumber:function(terminal,text,relativePoint){var charDimes=terminal.getCharDimes();var point=offset(relativePoint,terminal.getLineOffset());if(point.x<0||point.x>=terminal.getWidth()){return undefined}var lines=text.split("\n");for(var i=0,y=charDimes.y;i<lines.length;i++){if(point.y>=y-charDimes.y&&point.y<y){return i}y+=charDimes.y}return undefined},getLine:function(terminal,text,relativePoint){var lineNumber=mapper.getLineNumber(terminal,text,relativePoint);return codeAnalyzer.getLine(text,lineNumber)}};var offset=function(point,offset){return{x:point.x-offset.l,y:point.y-offset.t}};exports.mapper=mapper})(typeof exports==="undefined"?this:exports);(function(exports){var Mouser=function(id){this.events=new Eventer;var self=this;$(id).mousemove(function(e){self.events.emit("data",{event:"mousemove",point:relative(e,$(this))})});$(id).mouseout(function(e){self.events.emit("data",{event:"mouseout"})});$(id).click(function(e){self.events.emit("data",{event:"click",point:relative(e,$(this))})})};var relative=function(e,element){return{x:e.pageX-element.offset().left,y:e.pageY-element.offset().top}};exports.Mouser=Mouser})(typeof exports==="undefined"?this:exports);(function(exports){var Isla,_,codeAnalyzer;if(typeof module!=="undefined"&&module.exports){Isla=require("../node_modules/isla/src/isla.js").Isla;_=require("Underscore");codeAnalyzer=require("../src/code-analyzer").codeAnalyzer}else{Isla=window.Isla;_=window._;codeAnalyzer=window.codeAnalyzer}var ConsoleIndicator=function(terminal){var controllerId;this.write=function(e){if(e.event==="indicate"){var text=terminal.getText();if(e.data.thing==="token"){var lineNumber=codeAnalyzer.getLineNumber(text,e.data.index);var lineBox=getLineBox(terminal.getCategorisedText(),lineNumber,$(".jquery-console-prompt"));if(lineBox!==undefined){controllerId=e.id;indicateToken(lineBox,terminal.getText(),e.data.index)}}else if(e.data.thing==="line"){controllerId=e.id;var lineBox=getLineBox(terminal.getCategorisedText(),e.data.lineNumber,$(".jquery-console-prompt-box"));if(lineBox!==undefined){indicateLine(lineBox)}}}else if(e.event==="clear"&&e.id===controllerId){unindicate()}}};var unindicate=function(){unindicateAllTokens();unindicateAllLines()};var getLineBox=function(categorisedText,lineNumber,elements){for(var i=0,iPrompt;i<categorisedText.length;i++){if(categorisedText[i].io==="input"){iPrompt=iPrompt===undefined?0:iPrompt+1;if(i===lineNumber){return $(elements[iPrompt])}}}};var indicateToken=function(lineBox,text,index){var syntaxTokens=lineBox.children().not(".jquery-console-cursor");var syntaxTokenIndex=codeAnalyzer.getSyntaxTokenIndex(text,index);$(syntaxTokens[syntaxTokenIndex]).css({"background-color":"#444"})};var indicateLine=function(lineBox){lineBox.css({"background-color":"#444"});var tokens=lineBox.children().children().not(".jquery-console-cursor");_.map(tokens,function(x){$(x).css({"background-color":"#444"})})};var unindicateAllTokens=function(){var tokens=$(".jquery-console-prompt").children("span").not(".jquery-console-cursor");_.map(tokens,function(x){$(x).css({"background-color":"transparent"})})};var unindicateAllLines=function(){_.map($(".jquery-console-prompt-box"),function(x){$(x).css({"background-color":"transparent"})})};exports.ConsoleIndicator=ConsoleIndicator})(typeof exports==="undefined"?this:exports);(function(exports){var Isla,_,codeAnalyzer,nodeDescriber,expressionDescriber,mapper;if(typeof module!=="undefined"&&module.exports){Isla=require("../node_modules/isla/src/isla.js").Isla;_=require("Underscore");codeAnalyzer=require("../src/code-analyzer").codeAnalyzer;nodeDescriber=require("../src/node-describer").nodeDescriber;expressionDescriber=require("../src/expression-describer").expressionDescriber;mapper=require("../src/mapper").mapper}else{Isla=window.Isla;_=window._;codeAnalyzer=window.codeAnalyzer;nodeDescriber=window.nodeDescriber;expressionDescriber=window.expressionDescriber;mapper=window.mapper}var TextHelper=function(terminal,consoleIndicator,envStore,ui){var clearHelp=function(){ui.displayMessage("");ui.indicate(consoleIndicator,"clear",{})};var secondaryHelp=function(){if(codeAnalyzer.splitLines(terminal.getText()).length>1){clearHelp();ui.displayMessage("Hover over <u>words</u> and # signs to learn more")}};this.write=function(e){if(e.event==="mousemove"){handleHelp(terminal,e.point,envStore)}else if(e.event==="mouseout"||e.event==="text:new"){secondaryHelp()}};var handleHelp=function(terminal,point,envStore){var text=terminal.getText();if(isHelpForToken(terminal,point,envStore)){var index=mapper.getIndex(terminal,text,point);clearHelp();ui.indicate(consoleIndicator,"indicate",{thing:"token",index:index});ui.displayMessage(getTokenHelp(text,index,envStore));return}else if(isHelpforLine(terminal,point)){clearHelp();ui.indicate(consoleIndicator,"indicate",{thing:"line",lineNumber:mapper.getLineNumber(terminal,text,point)});ui.displayMessage(getLineHelp(mapper.getLine(terminal,text,point),envStore))}else{secondaryHelp()}}};var isHelpForToken=function(terminal,point,envStore){var text=terminal.getText();var index=mapper.getIndex(terminal,text,point);return index!==undefined&&codeAnalyzer.getSyntaxTokenIndex(text,index)!==undefined&&getTokenHelp(text,index,envStore)!==undefined};var isHelpforLine=function(terminal,point){var text=terminal.getText();var line=mapper.getLine(terminal,text,point);return mapper.getLineNumber(terminal,text,point)!==undefined&&codeAnalyzer.expression(line)!==undefined&&mapper.getIndex(terminal,text,point)===undefined};var getTokenHelp=function(text,index,envStore){try{return nodeDescriber.describe(text,index,envStore.latest())}catch(e){return e.message}};var getLineHelp=function(line,envStore){var node=codeAnalyzer.expression(line);try{return expressionDescriber.describe(node,envStore.latest())}catch(e){return e.message}};exports.TextHelper=TextHelper})(typeof exports==="undefined"?this:exports);(function(exports){var Isla,_,codeAnalyzer,nodeDescriber,expressionDescriber,mapper;if(typeof module!=="undefined"&&module.exports){Isla=require("../node_modules/isla/src/isla.js").Isla;_=require("Underscore");codeAnalyzer=require("../src/code-analyzer").codeAnalyzer;mapper=require("../src/mapper").mapper}else{Isla=window.Isla;_=window._;codeAnalyzer=window.codeAnalyzer;mapper=window.mapper}var CanvasHelper=function(terminal,demoTalker){this.write=function(e){if(e.event==="mousemove"){handleHelp(terminal,e.point,demoTalker)}else if(e.event==="mouseout"){demoTalker.emit("isla:mouse:mouseout")}};var handleHelp=function(terminal,point,demoTalker){var text=terminal.getText();var index=mapper.getIndex(terminal,text,point);if(isOverToken(terminal,point)){var syntaxNode=codeAnalyzer.getSyntaxNode(text,index);demoTalker.emit("isla:mouse:mouseover",{syntaxNode:syntaxNode,thing:"token"})}else if(isOverLine(terminal,point)){var lineNumber=mapper.getLineNumber(terminal,text,point);var line=codeAnalyzer.getLine(text,lineNumber);if(line.length>0){var syntaxTokens=codeAnalyzer.expressionSyntaxTokens(line);demoTalker.emit("isla:mouse:mouseover",{syntaxTokens:syntaxTokens,thing:"line"})}}}};var isOverToken=function(terminal,point){var text=terminal.getText();var index=mapper.getIndex(terminal,text,point);return index!==undefined&&codeAnalyzer.getSyntaxTokenIndex(text,index)!==undefined};var isOverLine=function(terminal,point){var text=terminal.getText();return mapper.getLineNumber(terminal,text,point)!==undefined&&(mapper.getIndex(terminal,text,point)===undefined||codeAnalyzer.parses(text)===undefined)};exports.CanvasHelper=CanvasHelper})(typeof exports==="undefined"?this:exports);(function(exports){var Helper=function(terminal,envStore,demoTalker){var consoleIndicator=new ConsoleIndicator(terminal);var mouser=new Mouser("div.jquery-console-inner");var textHelper=new TextHelper(terminal,consoleIndicator,envStore,ui.textHelper);mouser.events.on(textHelper,"data",textHelper.write);terminal.events.on(textHelper,"text:new",function(){textHelper.write({event:"text:new"})});demoTalker.on(this,"demo:indicator:indicate",function(e){consoleIndicator.write({event:"indicate",data:data})});var canvasHelper=new CanvasHelper(terminal,demoTalker);mouser.events.on(canvasHelper,"data",canvasHelper.write)};exports.Helper=Helper})(typeof exports==="undefined"?this:exports);(function(exports){var TextGrabber=function(){this.submittedText=[];this.currentLine={}};TextGrabber.prototype={write:function(e){if(e.event==="permanent"){var lines=e.text.split("\n");for(var i=0;i<lines.length;i++){if(lines[i]!==""){this.submittedText.push(newLine(lines[i]+"\n",e.io))}}this.currentLine=newLine("","input")}else{this.currentLine=newLine(e.text,e.io)}},getPlainText:function(){var out="";for(var i=0;i<this.submittedText.length;i++){out+=this.submittedText[i].text}out+=this.currentLine.text;return out},getCategorisedText:function(){var out=[];for(var i=0;i<this.submittedText.length;i++){out.push(this.submittedText[i])}out.push(this.currentLine);return out}};var newLine=function(text,io){return{text:text,io:io}};exports.TextGrabber=TextGrabber})(typeof exports==="undefined"?this:exports);(function(exports){var Isla,codeAnalyzer;if(typeof module!=="undefined"&&module.exports){Isla=require("../node_modules/isla/src/isla.js").Isla;codeAnalyzer=require("../src/code-analyzer").codeAnalyzer}else{Isla=window.Isla;codeAnalyzer=window.codeAnalyzer}var spaceToNbsp=function(str){return str.replace(/ /g,"&nbsp;")};var toSpan=function(t){return"<span class='"+t.syntax+"'>"+spaceToNbsp(t.code)+"</span>"};var addSpaceToken=function(tokens,spaceLen){return spaceLen>0?tokens.concat({code:new Array(spaceLen).join(" ")}):tokens};var codeLen=function(tokens){return tokens.reduce(function(a,x){return a+x.code.length},0)};exports.Highlighter={};exports.Highlighter.highlight=function(str){var markupPieces=codeAnalyzer.expressionSyntaxTokens(str);if(markupPieces===undefined){return spaceToNbsp(str)}else{var spacedMarkup=markupPieces.reduce(function(a,x){return addSpaceToken(a,x.index+1-codeLen(a)).concat(x)},[]);spacedMarkup=addSpaceToken(spacedMarkup,str.length+1-codeLen(spacedMarkup));return spacedMarkup.reduce(function(a,x){return a+(x.syntax===undefined?spaceToNbsp(x.code):toSpan(x))},"")}}})(typeof exports==="undefined"?this:exports);(function(exports){var consoleController,textGrabber;var Terminal=function(){consoleController=setUpConsoleController(this);this.events=new Eventer;var self=this;textGrabber=new TextGrabber;this.events.on(this,"submit",function(line){textGrabber.write({event:"permanent",text:line,io:"input"});self.events.emit("text:new")});this.events.on(this,"keypress",function(line){textGrabber.write({event:"impermanent",text:line,io:"input"});self.events.emit("text:new")});this.events.on(this,"history",function(line){textGrabber.write({event:"impermanent",text:line,io:"input"});self.events.emit("text:new")});this.events.on(this,"result",function(result){if(result!==""){textGrabber.write({event:"permanent",text:result,io:"output"});self.events.emit("text:new")}})};Terminal.prototype={setResult:function(result){result.msg=formatResult(result.msg,this.getCharsPerLine());var className="jquery-console-message-value";if(result.error===true){className="jquery-console-message-error"}lowlightAndAddQuestionMarkToOldPrompt();consoleController.commandResult([{msg:toHtml(result.msg),className:className}]);this.events.emit("result",result.msg)},submit:function(line){consoleController.typer.consoleInsert(line);consoleController.commandTrigger()},setPromptText:function(data){var markup=data.html;if(data.cursor===true){markup+=consoleController.cursor}$("span.jquery-console-prompt").last().html(markup);consoleController.updateCursorOffset()},getText:function(){return textGrabber.getPlainText()},getCategorisedText:function(){return textGrabber.getCategorisedText()},getPadding:function(){return{t:0,l:17}},getOffset:function(){var innerConsole=$(".jquery-console-inner");return{t:this.getPadding().t-innerConsole.scrollTop(),l:this.getPadding().l-innerConsole.scrollLeft()}},getLineOffset:function(){var innerConsole=$(".jquery-console-inner");return{t:-innerConsole.scrollTop(),l:-innerConsole.scrollLeft()}},getWidth:function(){return $(".jquery-console-inner").width()},getCharsPerLine:function(){return(this.getWidth()-this.getPadding().l)/this.getCharDimes().x},getCharDimes:function(){return{x:11,y:18}}};var setUpConsoleController=function(terminal){var consoleController=$("#console").console({promptLabel:">",commandValidate:commandValid,commandHandle:function(line){terminal.events.emit("submit",line)},autofocus:true,promptHistory:true});consoleController.typer.bind("focus",function(){$(".jquery-console-cursor").blink()});consoleController.typer.bind("blur",function(){$(".jquery-console-cursor").unblink()});consoleController.typer.bind("keypress",function(e){terminal.events.emit("keypress",consoleController.promptText())});consoleController.typer.bind("keyup",function(e){if(isCursorMovementKey(e)){terminal.events.emit("keypress",consoleController.promptText())}$(".jquery-console-cursor").blink()});consoleController.typer.bind("history",function(e){terminal.events.emit("history",consoleController.promptText())});return consoleController};var isCursorMovementKey=function(e){return e.keyCode===8||e.keyCode===37||e.keyCode===39};var formatResult=function(result,charsPerLine){var out="";for(var i=0,curLineChars=0;i<result.length;i++,curLineChars++){if(result[i]==="\n"){curLineChars=0}else if(curLineChars===charsPerLine){curLineChars=0;out+="\n"}out+=result[i]}return out};var toHtml=function(str){var out=str;var out=str.replace(/  /g,"&nbsp; ");return out};var commandValid=function(line){return line!==""};var lowlightAndAddQuestionMarkToOldPrompt=function(){$("span.jquery-console-prompt-label").last().css({color:"#555"});$("span.jquery-console-prompt-label").text("#")};exports.Terminal=Terminal})(typeof exports==="undefined"?this:exports);(function(exports){var _,Utils,EnvStore;if(typeof module!=="undefined"&&module.exports){_=require("Underscore");Utils=require("../node_modules/isla/src/utils.js").Utils;EnvStore=require("./env-store.js").EnvStore}else{_=window._;Utils=window.Isla.Utils;EnvStore=window.EnvStore}demoUtils={};demoUtils.random=function(guide){if(Utils.type(guide)==="Object"){var keys=_.keys(guide);return keys[Math.floor(Math.random()*keys.length)]}else{return Math.floor(Math.random()*guide)}};demoUtils.absMax=function(x,max){if(x<0){return x<-max?x:-max}else{return Math.max(x,max)}};demoUtils.isIslaType=function(obj,type){return obj._meta!==undefined&&obj._meta.type===type};demoUtils.translateNumberWord=function(word,words){var lowerWord=word.toLowerCase();if(words[lowerWord]!==undefined){return words[lowerWord]}else if(!isNaN(parseFloat(word))){return parseFloat(word)}else{throw"I do not understand this number: "+word}};demoUtils.edit=function(obj,removals){var ret=EnvStore.extend(true,{},obj);for(var i=0;i<removals.length;i++){delete ret[removals[i]]}return ret};demoUtils.plusMinus=function(x){return Math.random()>.5?x:-x};demoUtils.COLORS={red:"#FF0000",yellow:"#FFF700",green:"#4DFA51",blue:"#009DFE",indigo:"#5669FF",violet:"#8A6CFF"};demoUtils.color=function(raw){if(demoUtils.COLORS[raw]!==undefined){return demoUtils.COLORS[raw]}else{return raw}};exports.demoUtils=demoUtils})(typeof exports==="undefined"?this:exports);(function(exports){var DemoRunner=function(Demo){$(document).ready(function(){var demoTalker=new Eventer;var demo=new Demo($("#canvas")[0].getContext("2d"),demoTalker);var envStore=new EnvStore;envStore.write({event:"temp",env:Isla.Library.getInitialEnv()});envStore.write({event:"commit"});demoTalker.emit("isla:ctx:new",envStore.latestCommitted().ctx);demoTalker.on(this,"demo:ctx:new",function(ctx){var env=Isla.Library.getInitialEnv();env.ctx=ctx;envStore.write({event:"temp",env:env});envStore.write({event:"commit"})});var terminal=setupTerminal(demoTalker,envStore);var helper=new Helper(terminal,envStore,demoTalker);var tutor=setupTutor(demo,terminal);init(demo,terminal)})};var init=function(demo,terminal){demo.init();runIntro(demo,terminal)};var runIntro=function(demo,terminal){if(demo.intro!==undefined){for(var i=0;i<demo.intro().length;i++){terminal.submit(demo.intro()[i])}}};var setupTutor=function(demo,terminal){var tutor=new Tutor(demo.getTutorSteps(),ui.tutor);terminal.events.on(this,"submit",function(line){tutor.write({event:"demo:code:new",code:line})});return tutor};var setupTerminal=function(demoTalker,envStore){var terminal=new Terminal;terminal.events.on(this,"keypress",function(line){terminal.setPromptText({html:Highlighter.highlight(line),cursor:true})});terminal.events.on(this,"history",function(line){terminal.setPromptText({html:Highlighter.highlight(line),cursor:true})});terminal.events.on(this,"submit",function(line){var result;try{var env=Isla.Interpreter.interpret(line,envStore.latestCommitted());demoTalker.emit("isla:ctx:new",env.ctx);result={msg:env.ret||"",error:false}}catch(e){console.log(e.message);result={msg:e.message,error:true}}terminal.setPromptText({html:Highlighter.highlight(line),cursor:false});terminal.setResult(result)});return terminal};exports.DemoRunner=DemoRunner})(typeof exports==="undefined"?this:exports);